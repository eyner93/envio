<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tesoritos - Env√≠os</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
body { background: #F5F5F5; font-family: 'Inter', sans-serif; color:#374151; }
#map { height: 250px; width: 100%; border-radius: 0.75rem; margin-top: 0.5rem; }
#preview { background: #FFFFFF; padding:1rem; margin-top:0.5rem; border-radius:1rem; font-size:0.95rem; color:#374151; border:2px solid #1E3A8A; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
#preview h3 { text-align:center; font-size:1.2rem; color:#1E3A8A; margin-bottom:0.5rem; }
#preview .line { display:flex; justify-content:space-between; padding:4px 0; border-bottom:1px dashed #1E3A8A;}
#preview .line:last-child { border:none; }
#tesoritos-glow { text-shadow:0 0 5px #1E3A8A; color:#1E3A8A; }
.form-card {animation:fadeInUp 1s ease forwards; opacity:0; transform:translateY(20px);}
@keyframes fadeInUp { to { opacity:1; transform:translateY(0); } }
.btn-grad { background:#1E3A8A; color:white; font-weight:bold; padding:0.5rem 1rem; border-radius:0.5rem; transition:all 0.3s ease;}
.btn-grad:hover { transform:translateY(-2px); box-shadow:0 4px 8px rgba(0,0,0,0.2); cursor:pointer;}
#confirmarBtn { background:#D4AF37; color:#111; font-weight:bold; padding:0.5rem 1rem; border-radius:0.5rem; margin-top:1rem; cursor:pointer;}
#confirmarBtn:hover { background:#C4952E; }
input, select, textarea { border-radius:0.5rem; padding:0.5rem 1rem; border:1px solid #9CA3AF; box-shadow:0 1px 3px rgba(0,0,0,0.05); background:#FFFFFF; color:#374151;}
input:focus, select:focus, textarea:focus { outline:none; box-shadow:0 0 0 2px rgba(30,58,138,0.3); }
input:valid, select:valid, textarea:valid { background-color:#E6F4EA; }
footer { margin-top:2rem; text-align:center; padding:1rem; background:#1E3A8A; color:white; border-radius:1rem; width:100%; max-width:640px; font-weight:500; }
footer span { color:#D4AF37; font-weight:bold; }
</style>
</head>
<body class="flex flex-col items-center">

<header class="text-center py-10 bg-white shadow-md flex flex-col items-center gap-4 w-full">
<img src="imagenes/logo.jpg" alt="Tesoritos Logo" class="w-32 h-32 object-contain rounded-full shadow-md">
<h1 id="tesoritos-glow" class="text-4xl font-bold">‚ú® Tesoritos ‚ú®</h1>
<p class="text-gray-700 mt-2 text-center max-w-xl text-lg">
Joyer√≠a para dama üíé | Accesorios con estilo ‚ú® | Emprendimiento 100% en l√≠nea üì≤ | Productos al detalle üìù
<br>
Tu joyer√≠a favorita, sin salir de casa üíï üá≥üáÆ
</p>
</header>

<div class="bg-white shadow-lg rounded-2xl p-8 w-full max-w-lg mt-6 form-card">
<h2 class="text-2xl text-[#1E3A8A] font-bold text-center mb-6">Formulario de Env√≠o</h2>

<form id="envioForm" class="flex flex-col gap-4">
<label>Nombre de quien recibe:</label>
<input type="text" id="nombre" name="nombre" required>

<label>Celular (8 d√≠gitos):</label>
<input type="tel" id="celular" name="celular" placeholder="Ej: 50512345" required>

<label>¬øPodemos Contactarle por WhatsApp? (opcional):</label>
<select id="tieneWhatsapp" name="tieneWhatsapp">
<option value="">Seleccione...</option>
<option value="S√≠">S√≠</option>
<option value="No">No</option>
</select>

<label>Direcci√≥n:</label>
<input type="text" id="direccion" name="direccion" required>

<label>Observaciones:</label>
<textarea id="observaciones" name="observaciones" rows="3"></textarea>

<label>Selecciona tu ubicaci√≥n en el mapa (opcional):</label>
<div id="map"></div>
<button type="button" id="miUbicacionBtn" class="btn-grad mt-2">üìç Usar mi ubicaci√≥n</button>

<label>Vista previa del mensaje (ticket corporativo):</label>
<div id="preview">
<h3>NUEVO ENV√çO</h3>
<div class="line"><span>Nombre:</span><span>[Nombre]</span></div>
<div class="line"><span>Celular:</span><span>[Celular]</span></div>
<div class="line"><span>WhatsApp:</span><span>[WhatsApp no proporcionado]</span></div>
<div class="line"><span>Direcci√≥n:</span><span>[Direcci√≥n]</span></div>
<div class="line"><span>Observaciones:</span><span>[Sin observaciones]</span></div>
<div class="line"><span>Ubicaci√≥n:</span><span>[Ubicaci√≥n no proporcionada]</span></div>
<div class="line"><span>Distancia desde origen:</span><span>[Distancia no disponible]</span></div>
</div>

<div class="flex gap-2 mt-3 flex-col sm:flex-row">
<button type="button" id="copiarMensaje" class="btn-grad flex-1">Copiar mensaje</button>
<button type="button" id="confirmarBtn" class="flex-1">Enviar por WhatsApp</button>
</div>
</form>

<footer>
‚ú® Tesoritos ‚ú® | Tu joyer√≠a favorita üíé | Emprendimiento 100% en l√≠nea üì≤
</footer>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// PUNTO DE ORIGEN FIJO
const origen = { lat: 12.155224, lng: -86.299948 };

// MAPA
const map = L.map('map').setView([12.8654,-85.2072],7);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    attribution:'¬© OpenStreetMap'
}).addTo(map);

let marker;

// FUNCION GENERAL PARA COLOCAR MARCADOR
function colocarMarcador(latlng){
    if(marker){ marker.setLatLng(latlng); }
    else{
        marker = L.marker(latlng, {draggable:true}).addTo(map);
        marker.on('dragend', actualizarPreview);
    }
    map.setView(latlng, 18);
    actualizarPreview();
}

// CLIC EN MAPA (draggable)
map.on('click', e => { colocarMarcador([e.latlng.lat, e.latlng.lng]); });

// BOT√ìN "USAR MI UBICACI√ìN"
document.getElementById('miUbicacionBtn').addEventListener('click', ()=>{
    if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(pos=>{
            colocarMarcador([pos.coords.latitude, pos.coords.longitude]);
        }, ()=>{
            alert("No se pudo obtener tu ubicaci√≥n. Se usar√° ubicaci√≥n de prueba.");
            colocarMarcador([12.156, -86.300]); // Ubicaci√≥n de prueba cercana al origen
        });
    } else {
        alert("Tu navegador no soporta geolocalizaci√≥n. Se usar√° ubicaci√≥n de prueba.");
        colocarMarcador([12.156, -86.300]);
    }
});

// CAMPOS Y EVENTOS
const campos=['nombre','celular','direccion','observaciones'];
campos.forEach(id=>{ 
  const el=document.getElementById(id); 
  el.addEventListener('input',()=>{ marcarLleno(el); actualizarPreview(); });
});

// FONDO VERDE SUAVE
function marcarLleno(el){ el.value.trim()!=='' ? el.style.backgroundColor='#E6F4EA' : el.style.backgroundColor='white'; }

// VALIDACIONES
document.getElementById('nombre').addEventListener('input', e=>{ 
    e.target.value=e.target.value.replace(/[^a-zA-Z√°√©√≠√≥√∫√Å√â√ç√ì√ö√±√ë\s]/g,''); 
    marcarLleno(e.target); 
    actualizarPreview(); 
});
document.getElementById('celular').addEventListener('input', e=>{ 
    e.target.value=e.target.value.replace(/[^0-9]/g,'').slice(0,8); 
    marcarLleno(e.target); 
    actualizarPreview(); 
});

// FUNCIONES DISTANCIA
function calcularDistanciaKm(lat1, lng1, lat2, lng2) {
    const R = 6371;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLng = (lng2 - lng1) * Math.PI / 180;
    const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLng/2)**2;
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return (R * c).toFixed(2);
}

function actualizarPreview(){
    const nombre=document.getElementById('nombre').value||'[Nombre]';
    const celular=document.getElementById('celular').value||'[Celular]';
    const whatsapp=document.getElementById('tieneWhatsapp').value || '[WhatsApp no proporcionado]';
    const direccion=document.getElementById('direccion').value||'[Direcci√≥n]';
    const observaciones=document.getElementById('observaciones').value||'[Sin observaciones]';
    
    let ubicacion='[Ubicaci√≥n no proporcionada]';
    let distancia='[Distancia no disponible]';
    
    if(marker){
        const lat = marker.getLatLng().lat;
        const lng = marker.getLatLng().lng;
        ubicacion = `https://www.google.com/maps/dir/${origen.lat},${origen.lng}/${lat.toFixed(6)},${lng.toFixed(6)}`;
        distancia = `${calcularDistanciaKm(origen.lat, origen.lng, lat, lng)} km`;
        ubicacion = `<a href="${ubicacion}" target="_blank" style="color:#1E3A8A;text-decoration:underline;">Ver ruta en mapa</a>`;
    }

    document.getElementById('preview').innerHTML=`
        <h3>DATOS DE ENV√çO</h3>
        <div class="line"><span>Nombre:</span><span>${nombre}</span></div>
        <div class="line"><span>Celular:</span><span>${celular}</span></div>
        <div class="line"><span>WhatsApp:</span><span>${whatsapp}</span></div>
        <div class="line"><span>Direcci√≥n:</span><span>${direccion}</span></div>
        <div class="line"><span>Observaciones:</span><span>${observaciones}</span></div>
        <div class="line"><span>Ubicaci√≥n:</span><span>${ubicacion}</span></div>
        <div class="line"><span>Distancia desde origen:</span><span>${distancia}</span></div>
    `;
}

// GENERAR MENSAJE WHATSAPP
function generarMensajeWhatsApp(){
    const nombre=document.getElementById('nombre').value;
    const celular=document.getElementById('celular').value;
    const whatsapp=document.getElementById('tieneWhatsapp').value || '[WhatsApp no proporcionado]';
    const direccion=document.getElementById('direccion').value;
    const observaciones=document.getElementById('observaciones').value||'[Sin observaciones]';
    
    let ubicacion='[Ubicaci√≥n no proporcionada]';
    let distancia='[Distancia no disponible]';
    
    if(marker){
        const lat = marker.getLatLng().lat;
        const lng = marker.getLatLng().lng;
        ubicacion = `https://www.google.com/maps/dir/${origen.lat},${origen.lng}/${lat.toFixed(6)},${lng.toFixed(6)}`;
        distancia = `${calcularDistanciaKm(origen.lat, origen.lng, lat, lng)} km`;
    }

    const lineaSeparador="------------------------------";
    const titulo="TESORITOS - NUEVO ENV√çO\nJoyer√≠a & Accesorios\n";

    return `${titulo}${lineaSeparador}
Nombre del destinatario: ${nombre}
Celular: ${celular}
WhatsApp de contacto: ${whatsapp}
Direcci√≥n de entrega: ${direccion}
Observaciones: ${observaciones}
Ubicaci√≥n de entrega: ${ubicacion}
Distancia desde origen: ${distancia}
${lineaSeparador}
Gracias por tu preferencia.
Enviado desde Tesoritos - Tu joyer√≠a favorita`;
}

// COPIAR MENSAJE
document.getElementById('copiarMensaje').addEventListener('click', ()=>{
    navigator.clipboard.writeText(document.getElementById('preview').innerText).then(()=>{alert('Mensaje copiado ‚úÖ');});
});

// BOT√ìN CONFIRMAR
document.getElementById('confirmarBtn').addEventListener('click', ()=>{
    const nombre = document.getElementById('nombre').value.trim();
    const celular = document.getElementById('celular').value.trim();
    const direccion = document.getElementById('direccion').value.trim();

    if(!nombre || !celular || !direccion){
        alert("Por favor, completa todos los campos obligatorios antes de enviar el mensaje.");
        return;
    }

    if(celular.length !== 8){
        alert("El n√∫mero de celular debe tener exactamente 8 d√≠gitos.");
        return;
    }

    if(confirm("¬øConfirmas que los datos son correctos y deseas enviar el mensaje por WhatsApp?")){
        const mensaje=generarMensajeWhatsApp();
        const numeroDestino="50558540223";
        window.open(`https://wa.me/${numeroDestino}?text=${encodeURIComponent(mensaje)}`, '_blank');
    }
});

// INTENTAR OBTENER UBICACI√ìN AUTOM√ÅTICAMENTE
window.addEventListener('load', () => {
    if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(pos=>{
            const latlng = [pos.coords.latitude, pos.coords.longitude];
            if(marker){ 
                marker.setLatLng(latlng); 
            } else {
                marker = L.marker(latlng, {draggable:true}).addTo(map);
                marker.on('dragend', actualizarPreview);
            }
            map.setView(latlng, 18);
            actualizarPreview();
        }, ()=> {
            console.log("No se pudo obtener la ubicaci√≥n autom√°ticamente.");
        });
    } else {
        console.log("Navegador no soporta geolocalizaci√≥n.");
    }
});

</script>

</body>
</html>
